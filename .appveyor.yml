notifications:
    - provider: Email
      on_build_success: false

clone_folder: c:\projects\okhttp-fork
clone_script:
    - git config --global core.autocrlf input
    - git clone --recursive --branch=%APPVEYOR_REPO_BRANCH% https://github.com/%APPVEYOR_REPO_NAME%.git %APPVEYOR_BUILD_FOLDER%
    - git checkout -qf %APPVEYOR_REPO_COMMIT%

shallow_clone: true

build:
    parallel: true

environment:
    OPENSSL_ROOT_DIR: C:\OpenSSL-Win64
    matrix:
        - SHARED: ON
          APPVEYOR_BUILD_WORKER_IMAGE: Visual Studio 2017
        - SHARED: ON
          APPVEYOR_BUILD_WORKER_IMAGE: Visual Studio 2015
        - SHARED: OFF
          APPVEYOR_BUILD_WORKER_IMAGE: Visual Studio 2017
        - SHARED: OFF
          APPVEYOR_BUILD_WORKER_IMAGE: Visual Studio 2015

matrix:
    fast_finish: false
    allow_failures:
        - SHARED: ON

configuration:
    - Debug
    - Release

build_script:
    - mkdir build
    - cd build
    - cmake .. -DCMAKE_BUILD_TYPE=%CONFIGURATION% -DBUILD_SHARED_LIBS=%SHARED% -DDTLS=ON
    - cmake --build .
